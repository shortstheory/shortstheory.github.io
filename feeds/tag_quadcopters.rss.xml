<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>A Singularity</title><link>http://arnavdhamija.com/</link><description></description><atom:link href="http://arnavdhamija.com/feeds/tag_quadcopters.rss.xml" rel="self"></atom:link><lastBuildDate>Tue, 13 Jun 2017 09:30:00 +0530</lastBuildDate><item><title>Quadcopters - A Hitchhiker's Guide to the Sky</title><link>http://arnavdhamija.com/blog/quadcopter-2.html</link><description>&lt;p&gt;We have liftoff!&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://arnavdhamija.com/images/quadcopter/liftoff.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Cue me trying to not get my fingers cut off when holding the quadcopter&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The quadcopter has been built! I had some problems during the building process, so this is a guide which will hopefully make things easier for people to start off with making their own quadcopters.&lt;/p&gt;
&lt;p&gt;I suggest going through all these websites thoroughly before purchasing a single part for your quadcopter. It's not an extensive list, so I'll keep updating it as I find more useful links:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://oscarliang.com/"&gt;OscarLiang&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="www.propwashed.com/"&gt;Propwashed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wowelec.wordpress.com/"&gt;WowElec&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.dronetrest.com/"&gt;DroneTrest&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Hardware Assembly&lt;/h2&gt;
&lt;p&gt;For clarity, the components I have used in my build are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1045 Propellers x4&lt;/li&gt;
&lt;li&gt;REES52 DJI F450 Frame&lt;/li&gt;
&lt;li&gt;REES52 CC3D F1 Flight Computer&lt;/li&gt;
&lt;li&gt;REES52 1000KV A2212 30A Brushless Motor x4&lt;/li&gt;
&lt;li&gt;REES52 SimonK 30A Electronic Speed Controllers x4&lt;/li&gt;
&lt;li&gt;APM 4-axis Power Distribution Board Type-B1&lt;/li&gt;
&lt;li&gt;SunRobotics 2200mAh 3S 35C LiPo Battery&lt;/li&gt;
&lt;li&gt;FlySky FSCT6B Computer Transmitter&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Most of these parts can be picked straight off Amazon. REES52 has a good &lt;a href="http://www.amazon.in/REES52-A2212-1000KV-Brushless-Propeller/dp/B01BJWLI6C/ref=sr_1_3?ie=UTF8&amp;amp;qid=1495506091&amp;amp;sr=8-3&amp;amp;keywords=1000kv+motor"&gt;bundle&lt;/a&gt; for a pair of propellers, 1000 KV motor, and ESC which I would recommend buying to keep costs low.&lt;/p&gt;
&lt;h3&gt;Frame&lt;/h3&gt;
&lt;p&gt;The first thing you would want to do is start off with the frame of the quadcopter. If you go for a DJI F450 frame (or one of its hundred clones), you will get a box with four arms (technically called booms) for mounting the motors and ESCs, a base which doubles as a power distribution board, and a board to hold the top of the copter together. It's pretty simple to set up and all you need is two Allen keys to screw everything together.&lt;/p&gt;
&lt;p&gt;I suggest labelling each boom with a number and the direction in which its motor is supposed to spin. The below diagram is a good starting point:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://arnavdhamija.com/images/quadcopter/lpconfig.png" /&gt;&lt;/p&gt;
&lt;p&gt;Speaking about labelling, label &lt;em&gt;everything&lt;/em&gt;. It only takes a few seconds and it can save many hours of frustration later on. Of note, is the handedness (is there a better term?) of the propeller. Left-handed propellers turn anticlockwise and right-handed propellers turn clockwise. Mounting a propeller the wrong way will cause the thrust it to produce thrust in the opposite direction.&lt;/p&gt;
&lt;h3&gt;Motors&lt;/h3&gt;
&lt;p&gt;Once you've setup the frame, the next thing you should do is take a look at the motors. These motors are &lt;a href="https://en.wikipedia.org/wiki/Brushless_DC_electric_motor"&gt;brushless&lt;/a&gt; &lt;a href="http://electronics.howstuffworks.com/brushless-motor.htm"&gt;motors&lt;/a&gt; and they are very different from brushed motors. For starters they have three wires instead of the two on brushed motors. Another pecularity about these motors is that they are outrunner motors. This means that the case of the motor rotates with the propeller and not the motor shaft alone.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://arnavdhamija.com/images/quadcopter/brushless.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;Despite being a lot more power efficient than brushed motors, these motors can generate a great deal of heat when running at full power. I would &lt;em&gt;not&lt;/em&gt; recommend testing it at full power on the ground as there won't be any airflow to cool the motor down. This can permenantly damage your motor, and if you're unlucky, your ESC as well.&lt;/p&gt;
&lt;p&gt;Anyway, the motors can be screwed directly into the booms of the quadcopter. The direction of rotation is determined by the ESC, so we don't need to worry about that at the moment.&lt;/p&gt;
&lt;h3&gt;ESCs&lt;/h3&gt;
&lt;p&gt;The ESCs link the flight computer with the motors. The input to the ESC is PWM fed over the BEC connector. Each ESC have its own 8-bit SoC to send signals to the brushless motor to turn at the desired RPM. In the FC settings, you can adjust the ESC update frequency, which is usually between 50Hz and 490Hz.&lt;/p&gt;
&lt;p&gt;Mount the ESCs on to the booms with rubber bands, or better, zip-ties.&lt;/p&gt;
&lt;p&gt;The ESCs regulate the amount of power going to the motor depending on throttle input and can get very hot as well. Mounting the ESCs under the booms will give it sufficient airflow to cool down properly. You want to make sure that the three wires with female bullet connectors is facing the male bullet connectors of the motor. The other side with the male connector and the BEC goes to the power distribution board of the quadcopter.&lt;/p&gt;
&lt;p&gt;As with all electronics with large capactiors, ESCs can have spectacular explosions when things go wrong. Short circuits or using the wrong polarity on the power input side of the ESC can cause it to get damaged in the matter of seconds.&lt;/p&gt;
&lt;p&gt;On the other hand, things are a lot more flexible on the power output side of the ESC. It is possible to connect the three output connectors in any order to the motor, but a good rule of thumb is to connect the middle wire of the ESC to the ground wire of the motor and to interchange the other two wires to reverse the direction of rotation.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://arnavdhamija.com/images/quadcopter/escmount.jpg" /&gt;&lt;/p&gt;
&lt;h3&gt;Power Distribution board&lt;/h3&gt;
&lt;p&gt;The frame of your quadcopter probably will have a power distribution board of its own with solder points. However, I used a separate &lt;a href="http://www.amazon.in/APM-PX4-Power-Distribution-Board/dp/B010NK8V70/ref=sr_1_2?ie=UTF8&amp;amp;qid=1496164735&amp;amp;sr=8-2&amp;amp;keywords=power+distribution+board"&gt;power distribution board&lt;/a&gt; with the B1-type connectors for the ESCs and the battery.&lt;/p&gt;
&lt;p&gt;This went right under the base of the quadcopter. It's a bit of tight fit to get all the ESC connecting wires under the base. Again, use zip-ties to secure it to the base.&lt;/p&gt;
&lt;p&gt;The ground clearance is quite low with the power distribution board attached. You can buy a landing gear or make your own to increase this.&lt;/p&gt;
&lt;p&gt;I made a DIY landing gear for my own quadcopter using a badminton shuttlecock tube. It absorbs shocks nicely and gives me just enough ground clearance to mount more components.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://arnavdhamija.com/images/quadcopter/landingear.jpeg" /&gt;&lt;/p&gt;
&lt;h3&gt;Flight Computer and Battery&lt;/h3&gt;
&lt;p&gt;Now for the good stuff, go ahead and mount the CC3D on the top frame of the quadcopter. Most CC3D's will come with some plastic adapters and a sticky sheet to stick the CC3D on the quadcopter frame. Take note of the arrow on the CC3D and make sure it is facing the direction in which you want your quadcopter to fly forward. Make sure you leave enough room for keeping the mini USB port and the servo header pins accessible!&lt;/p&gt;
&lt;p&gt;After &lt;a href="http://helihelp.rabbitsvc.com/BindingTheTransmitter.aspx"&gt;binding&lt;/a&gt; the transmitter to the receiver, plug it into the receiver port of the CC3D. If you use the FlySky CT6B transmitter/receiver, the receiver probably won't work when directly connected to the CC3D on USB power. If so, you can use an Arduino's 5V and GND to power the receiver for testing it. When flying the quadcopter on Li-Po power, the CC3D will be powered by the ESC BECs which will give it enough headroom to power the receiver.&lt;/p&gt;
&lt;p&gt;The receiver can be mounted pretty much anywhere as it is quite small. I mounted the receiver on my quadcopter on the boom.&lt;/p&gt;
&lt;p&gt;The final step is to add the Li-Po battery to the frame. Some prefer to mount the battery to the base of the quadcopter, but I found mounting the battery right under the top frame (under the CC3D) from E-W was much better for the quadcopter's stability. My guess is that this keeps the vertical CoG of the copter closer to the level of application of force, reducing the torque when copter makes a maneouver.&lt;/p&gt;
&lt;p&gt;Again, the place where you mount your battery is dependant on the size of the battery. Secure the battery with as many zip-ties as you want. There's no such thing as using too many zip-ties to secure components on quadcopters.&lt;/p&gt;
&lt;h3&gt;Putting It Together&lt;/h3&gt;
&lt;h4&gt;ESC Callibration&lt;/h4&gt;
&lt;p&gt;Before you start configuring your CC3D, it's a good idea to make sure your sure your ESC and motors are working properly. For this, connect the ESC &lt;strong&gt;directly&lt;/strong&gt; to the battery and the ESC's BEC straight into the 3&lt;sup&gt;rd&lt;/sup&gt; channel of your receiver. Keep the transmitter switched on with zero throttle input. On connecting the battery, you will hear a callibration beep from the motor. Put the throttle to max power and hold till you hear another callibration beep. After bringing the throttle back to zero input, you should now be able to drive the motor by varying the throttle input.&lt;/p&gt;
&lt;p&gt;In case the motor spins the wrong way, just swap the red and yellow wires of the motor.&lt;/p&gt;
&lt;h4&gt;Cable Management&lt;/h4&gt;
&lt;p&gt;This isn't really cable management, but I couldn't think of a better title for this section 😅&lt;/p&gt;
&lt;p&gt;Connect the ESCs' BECs to the CC3D. The order will have to be changed later when setting up the CC3D so don't worry about that for now. I looped the cables through the holes in the top of the frame so they weren't hanging off the side of the copter. The white wire should face upwards.&lt;/p&gt;
&lt;p&gt;The receiver is quite straightforward to setup. The first cable has three leads, one for signal and two for power. The rest of the cables have only one signal lead. Just connect this in the order to which it is connected on the the receiver port side of the leads.&lt;/p&gt;
&lt;p&gt;The male connectors for the ESC can go right into the power distribution board.&lt;/p&gt;
&lt;h2&gt;Software Configuration&lt;/h2&gt;
&lt;p&gt;The CC3D is a nifty microcontroller. It can be flashed with different flight computer firmwares and can be extended with GPS and Telemetry capabilities. For now, we will work on a much more humble task - flashing it with a FC firmware.&lt;/p&gt;
&lt;p&gt;As the CC3D has been around for a while, it has a good amount of community support in terms of open-source FC firmwares. Two popular ones are &lt;a href="http://cleanflight.com/"&gt;Cleanflight&lt;/a&gt; and &lt;a href="http://librepilot.atlassian.net/"&gt;LibrePilot&lt;/a&gt; built out of the ashes of the now defunct OpenPilot.&lt;/p&gt;
&lt;p&gt;The firmware gives the CC3D brains to control copter and make decisions on the accelerometer and gyroscope readings. It has a sophisticated PID algorithm to do so.&lt;/p&gt;
&lt;p&gt;Both firmwares come with cross-platform desktop apps for configuring the FC. Cleanflight uses a shiny Chrome web-app and LibrePilot has a traditional Qt desktop app. I liked Cleanflight at first, but &lt;a href="http://dronehitech.com/en/flash-cleanflight-cc3d-arduino/"&gt;flashing it on the CC3D&lt;/a&gt; is a mess and I couldn't get it to work properly. On the other hand, LibrePilot is a joy to flash on the CC3D. The desktop app even auto-updates the CC3D's firmware if it is out of date. Therefore, being unable to flash Cleanflight, I setup the quadcopter in LibrePilot instead.&lt;/p&gt;
&lt;p&gt;LibrePilot has a pretty easy 'Vehicle Setup Wizard' which if followed correctly, will get your quadcopter to airworthy shape 95% of the time.&lt;/p&gt;
&lt;h2&gt;Fly!&lt;/h2&gt;
&lt;p&gt;Or at least try to if you're a beginner :P If you're using LibrePilot, the default setting has stability assist which makes flying easier. For the more experienced (or gung ho) type of pilot, you can change the settings to use Rate/Acro mode to get full manual control of the aircraft.&lt;/p&gt;
&lt;p&gt;And that's it for this tutorial. I'll be writing more as I get more experienced with flying my quadcopters.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Arnav Dhamija</dc:creator><pubDate>Tue, 13 Jun 2017 09:30:00 +0530</pubDate><guid>tag:arnavdhamija.com,2017-06-13:blog/quadcopter-2.html</guid><category>Electronics</category><category>Quadcopters</category></item><item><title>Quadcopters - The Beginning!</title><link>http://arnavdhamija.com/blog/quadcopter-1.html</link><description>&lt;p&gt;I've been gravitating more towards working on electronics projects. It's a nice change from pecking the keyboard all day and it has plenty of interesting challenges of its own. The biggest difference I found is that you just can't take your hardware working correctly for granted. Things break and catch fire all too easily if you're not careful with what you're doing.&lt;/p&gt;
&lt;p&gt;My plan is to make a quadcopter from scratch (a rather loose term) and give it &lt;em&gt;some&lt;/em&gt; ability to navigate unsupervised. This approach is (aptly?) called Simultaneous Localisation and Mapping, or SLAM. SLAM is by no means a cheap affair, be it in terms of hardware or software complexity. Using SLAM outdoors normally requires some kind of 3D localiser (such as a depth camera or LIDAR), GPS, and a fairly beefy computer to map the environment.&lt;/p&gt;
&lt;p&gt;Of course, I'm setting my expectations low, and I will be very happy if I can get something out of this which is 10% as good as a human flying quadcopter by hand.&lt;/p&gt;
&lt;p&gt;It all begins with the hardware and I'm going with this parts list:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1045 Propellers x4&lt;/li&gt;
&lt;li&gt;REES52 DJI F450 Frame&lt;/li&gt;
&lt;li&gt;REES52 CC3D F1 Flight Computer&lt;/li&gt;
&lt;li&gt;REES52 1000KV A2212 30A Brushless Motor x4&lt;/li&gt;
&lt;li&gt;REES52 SimonK 30A Electronic Speed Controllers&lt;/li&gt;
&lt;li&gt;SunRobotics 2200mAh 3S 35C LiPo Battery&lt;/li&gt;
&lt;li&gt;FlySky FSCT6B Computer Transmitter&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The amount of embedded systems tech in these components is astounding. Each motor is driven by an ESC, which is essentially a full-fledged 8-bit SoC. The CC3D Flight Computer is an engineering marvel in it's own right - it comes with a 32-bit/72MHz flashable microcontroller, an MPU6000 gyroscope/accelerometer for the IMU, and has expansion ports for GPS and Telemetry data. Even the battery is remarkable - it's capable of discharging 850W at peak performance.&lt;/p&gt;
&lt;p&gt;What I'm interested in, however, is controlling the CC3D in real-time using an Arduino. Typically, the CC3D is connected to a radio receiver which is wirelessly linked to a transmitter remote which is controlled by hand. The reciever is interfaced to the CC3D by outputting a PWM to each of the 6 channels when the transmitter is operated. Each channel is usually dedicated to only one axis of movement. For example, there are four dedicated channels for throttle control, yaw, roll, and pitch.&lt;/p&gt;
&lt;p&gt;The idea behind this is that one day, I will have a lightweight computer (anyone willing to donate an NUC?) on the quadcopter doing SLAM in real-time. The computer will send throttle, pitch, yaw, and roll commands to the Arduino. The Arduino in turn will feed the CC3D with control signals to execute the maneouver plan. It all may seem like a Rube Goldberg machine, but it's a lot easier than building my own flight computer to do the same.&lt;/p&gt;
&lt;p&gt;To kick things off, I had to find the PWM frequency the receiver uses for controlling the ESC. To do this, I connected a pin from the output channel of the receiver to an ad-hoc &lt;a href="http://www.instructables.com/id/Arduino-Oscilloscope-poor-mans-Oscilloscope/"&gt;Arduino Leonardo oscilloscope&lt;/a&gt;. Using the Processing library, we can get a 0-5V reading of the value on the A0 analog input of the Arduino.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://arnavdhamija.com/images/quadcopter/Capture2.PNG" /&gt;&lt;/p&gt;
&lt;p&gt;Not a bad start! The peaks are a pretty clear sign that it's a PWM with a low duty cycle. Using a ruler and some more code, I found that the peak to peak time is about 20ms, which works out to be a PWM frequency of 50Hz. This is in line with some websites speculating it works similarly to a servo control.&lt;/p&gt;
&lt;p&gt;The length of time at the peak gives us the signal we need to send using the Arduino. Using some more analysis of the waveform, it looked like the signal were about 1-2ms long. A bit more research yielded that this is very similar to the waveform used for controlling servos. Fortunately, the Arduino has a Servo library meant just for this purpose. Using the writeMicroseconds() function, I got a pretty similar waveform:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://arnavdhamija.com/images/quadcopter/Capture7.PNG" /&gt;&lt;/p&gt;
&lt;p&gt;I would go as far to say that this is an even &lt;em&gt;cleaner&lt;/em&gt; signal than what the reciever outputs. I needed a 5V-&amp;gt;3.3V voltage divider for the output, so I used 3 identical resistors in series to do the job.&lt;/p&gt;
&lt;p&gt;Next thing was to get the CC3D to accept the input. For this it requires &lt;strong&gt;manual&lt;/strong&gt; calibration of the transmitter. In Librepilot, the procedure is quite straightforward - you need to shift the sticks through their minimum, maximum, and neutral outputs to calibrate the CC3D for your transmitter. To do this, I mounted a push button on the Arduino which would cycle through 3 states each time it is pressed - 1100uS, 1500uS, and 1900uS. Not very elegant. Then again, if it's stupid but works, it ain't stupid.&lt;/p&gt;
&lt;p&gt;I will be building the rest of the quadcopter once the parts arrive. You can find the code for the Arduino part here: &lt;a href="https://github.com/shortstheory/quadcopter-experiments/blob/master/tristate.ino"&gt;https://github.com/shortstheory/quadcopter-experiments/blob/master/tristate.ino&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Arnav Dhamija</dc:creator><pubDate>Fri, 26 May 2017 09:30:00 +0530</pubDate><guid>tag:arnavdhamija.com,2017-05-26:blog/quadcopter-1.html</guid><category>Electronics</category><category>Quadcopters</category></item></channel></rss>